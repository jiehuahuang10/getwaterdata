# 石滩供水数据管理系统 - 使用指南

## 🌟 快速导航

- [访问系统](#访问系统)
- [月度统计表管理](#月度统计表管理)
- [水务数据查询](#水务数据查询)
- [手动数据更新](#手动数据更新)
- [常见问题](#常见问题)

---

## 📱 访问系统

### 在线访问
直接访问: **https://getwaterdata.onrender.com**

> ⚠️ **首次访问提示**: 如果页面加载较慢（超过30秒），说明服务正在从休眠状态唤醒，这是正常现象，请耐心等待。

### 本地访问
如果需要在本地运行：
```bash
python app_unified.py
```
然后访问 http://localhost:5000

---

## 💼 月度统计表管理

### 功能说明
每月月底添加下个月的分区计量统计表。

### 使用步骤

#### 1. 进入功能页面
在主页点击 **"月度统计表管理"** 卡片

#### 2. 查看当前信息
系统会自动显示：
- 📅 当前要添加的月份（例如：2025年10月）
- 📊 Excel文件路径
- 📈 可用的历史月份范围

#### 3. 输入售水量数据
在输入框中填写三个区的售水量：

```
┌─────────────────────────┐
│ 1 区售水量:  [________] │
│ 2 区售水量:  [________] │
│ 3 区售水量:  [________] │
└─────────────────────────┘
```

**示例数据**:
- 1 区售水量: `123452`
- 2 区售水量: `543455`
- 3 区售水量: `757688`

#### 4. 点击新增按钮
点击 **"新增下月统计表"** 按钮

#### 5. 等待处理
系统会自动：
- ✅ 提取供水量数据
- ✅ 计算损耗水量
- ✅ 计算水损耗率
- ✅ 生成完整表格
- ✅ 同步到GitHub

#### 6. 查看结果
成功后会显示：
```
✅ 成功添加2025年10月统计表！
📝 已提取3个区域的数据
✅ 已自动同步到GitHub

[📥 下载更新后的Excel文件]
```

### 生成的表格格式

```
                    2025年10月
─────────────────────────────────────────────────────
            监控表供水量                    损耗统计
─────────────────────────────────────────────────────
     荔新  宁西  如丰  新城  三棵  供水  售水  损耗  水损
     大道  2总  大道  大道  树    量    量    水量  耗率
1 区 xxxxx xxxxx xxxxx xxxxx xxxxx xxxxx xxxxx xxxxx xx.xx%
2 区 xxxxx xxxxx xxxxx xxxxx xxxxx xxxxx xxxxx xxxxx xx.xx%
3 区 xxxxx xxxxx xxxxx xxxxx xxxxx xxxxx xxxxx xxxxx xx.xx%
─────────────────────────────────────────────────────
合计 xxxxx xxxxx xxxxx xxxxx xxxxx xxxxx xxxxx xxxxx xx.xx%
```

### 重要说明

📌 **数据来源**:
- 监控表供水量：自动从 `石滩供水服务部每日总供水情况.xlsx` 提取
- 售水量：手动输入
- 损耗水量：自动计算（供水量 - 售水量）
- 水损耗率：自动计算（损耗水量 / 供水量 × 100%）

📌 **数据验证**:
- 系统会验证售水量必须大于0
- 如果售水量大于供水量，会显示警告

📌 **文件同步**:
- 成功后自动同步到GitHub
- 如果同步失败，可以手动下载文件后上传到GitHub

---

## 📊 水务数据查询

### 功能说明
查看最近7天的8个水表读数。

### 使用步骤

#### 1. 进入功能页面
在主页点击 **"水务数据查询"** 卡片

#### 2. 查看数据
页面会自动加载最近的数据：

```
系统信息
━━━━━━━━━━━━━━━━━━━━━━
当前时间: 2025-10-25 13:30:00
数据范围: 2025-10-18 至 2025-10-24
━━━━━━━━━━━━━━━━━━━━━━

水表数据
┌────────┬──────────┬────────┐
│ 日期   │ 水表名称 │ 读数   │
├────────┼──────────┼────────┤
│ 2025-10│ 荔新大道 │ 143856 │
│ -24    │ 新城大道 │  15098 │
│        │ ...      │  ...   │
└────────┴──────────┴────────┘
```

#### 3. 刷新数据
点击 **"获取最近7天数据"** 按钮重新获取

#### 4. 导出数据
点击 **"导出Excel"** 按钮下载数据文件

### 水表说明

系统监控的8个水表：
1. 荔新大道DN1200监控表
2. 新城大道医院DN800监控表
3. 宁西2总表DN1200
4. 如丰大道600监控表
5. 沙庄总表
6. 2501200108
7. 三棵树600监控表
8. 荣山墟路DN300监控表

---

## 🔄 手动数据更新

### 功能说明
手动选择日期更新水表数据到Excel文件。

### 使用场景
- 📅 补充历史缺失数据
- ⚠️ 修正错误数据
- 🔄 重新获取某天数据

### 使用步骤

#### 1. 进入功能页面
在主页点击 **"手动数据更新"** 卡片

#### 2. 选择日期
两种方式选择日期：

**方式一：手动选择**
```
选择更新日期: [日期选择器]
```

**方式二：快速选择昨天**
```
[快速选择昨天] 按钮
```

#### 3. 执行更新
点击 **"执行更新"** 按钮

#### 4. 查看结果
```
更新中，请稍候...
━━━━━━━━━━━━━━━━
✅ Excel文件更新成功！
更新日期: 2025-10-24
更新水表: 8个
文件: 石滩供水服务部每日总供水情况.xlsx
```

### 注意事项

⚠️ **数据可用性**:
- 只能获取水务系统中存在的日期数据
- 如果选择的日期没有数据，会显示错误提示

⚠️ **更新频率**:
- 建议不要频繁手动更新
- 每天下午6点会自动更新昨天的数据

---

## ❓ 常见问题

### Q1: 页面打开很慢怎么办？
**A**: 这是正常现象。Render免费版服务在15分钟无活动后会休眠，首次访问需要约30秒唤醒。后续访问会很快。

---

### Q2: 如何确认每日数据是否正常更新？
**A**: 有三种方式：
1. 访问 https://github.com/jiehuahuang10/getwaterdata/actions 查看Actions执行记录
2. 查看GitHub仓库中 `execution_status.md` 文件
3. 使用"水务数据查询"功能查看最新数据

---

### Q3: 月度统计表添加后，如何确认同步到GitHub成功？
**A**: 
- 成功时页面会显示 "✅ 已自动同步到GitHub"
- 访问 https://github.com/jiehuahuang10/getwaterdata/commits/main 查看最新提交
- 最新提交应该包含 "自动更新: 添加XXXX年XX月统计表"

---

### Q4: 如果GitHub同步失败怎么办？
**A**: 
1. 点击页面上的 "📥 下载更新后的Excel文件" 按钮
2. 手动上传文件到GitHub仓库
3. 或者联系管理员检查 `GITHUB_TOKEN` 配置

---

### Q5: 输入的售水量可以修改吗？
**A**: 
可以。有两种方式：
1. 重新运行添加统计表（会覆盖之前的数据）
2. 直接编辑GitHub上的Excel文件（不推荐）

---

### Q6: 系统支持哪些浏览器？
**A**: 
推荐使用：
- ✅ Chrome（推荐）
- ✅ Edge
- ✅ Firefox
- ✅ Safari

---

### Q7: 手机可以使用吗？
**A**: 
可以！系统支持响应式设计，手机浏览器可以正常使用所有功能。

---

### Q8: 数据会丢失吗？
**A**: 
不会。系统有多重保障：
- 📁 所有Excel文件存储在GitHub（版本控制）
- 🔄 每次修改自动备份
- 📊 可以随时下载历史版本

---

### Q9: 如何查看历史执行日志？
**A**: 
1. GitHub Actions日志: https://github.com/jiehuahuang10/getwaterdata/actions
2. Render实时日志: 登录Render Dashboard查看
3. 本地日志文件: `github_automation.log`

---

### Q10: 系统出现错误怎么办？
**A**: 
1. 刷新页面重试
2. 清除浏览器缓存
3. 查看错误提示信息
4. 联系技术支持

---

## 📞 获取帮助

### 快速帮助
- 📖 查看 [详细文档](PROJECT_README.md)
- 🔍 查看 [GitHub Issues](https://github.com/jiehuahuang10/getwaterdata/issues)

### 技术支持
如遇到问题，请提供：
1. 出错时间
2. 错误截图
3. 操作步骤
4. 浏览器版本

---

## 💡 使用技巧

### 技巧1: 快速添加月度统计
```
每月25号左右 → 访问系统 → 月度统计表管理 → 输入售水量 → 新增
```

### 技巧2: 定期检查数据
```
每周一 → 水务数据查询 → 查看最近7天 → 确认数据正常
```

### 技巧3: 保存常用链接
将以下链接添加到浏览器书签：
- 主页: https://getwaterdata.onrender.com
- 月度统计: https://getwaterdata.onrender.com/summary
- 数据查询: https://getwaterdata.onrender.com/data

---

**祝使用愉快！** 🎉

---

**文档版本**: v2.0  
**最后更新**: 2025-10-25  
**适用系统**: 石滩供水数据管理系统


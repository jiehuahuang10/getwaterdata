# Excel导出功能说明

## 📊 功能概述

水务数据获取系统现已支持Excel导出功能，可以将获取的水表数据导出为格式化的Excel文件，方便数据分析和报告制作。

## ✨ 功能特点

### 🎯 数据内容
- **横向布局**: 日期作为行，水表作为列，便于对比分析
- **完整时间范围**: 导出所有获取的日期数据（通常为7-8天）
- **8个水表数据**: 包含所有配置的水表完整数据
- **智能处理**: 自动处理缺失数据，空值显示为空白

### 🎨 Excel样式
- **现代化设计**: 采用专业的表格样式和配色方案
- **数据可视化**: 大用水量数据自动高亮显示
- **统计信息**: 自动计算水表总数、有效数据数量和完整率
- **中文字体**: 使用微软雅黑字体，确保中文显示效果

### 📋 文件格式
```
水表数据_开始日期至结束日期_时间戳.xlsx
例如: 水表数据_20250808至20250815_20250816_220844.xlsx
```

## 🚀 使用方法

### 方法一：Web界面导出
1. 访问 http://localhost:5000
2. 点击"🚀 获取最近7天数据"按钮
3. 等待数据获取完成
4. 点击"📊 导出Excel"按钮
5. 系统会自动下载生成的Excel文件

### 方法二：命令行导出
```bash
# 使用测试数据导出
python excel_exporter.py

# 使用真实数据导出
python test_excel_with_real_data.py
```

## 📁 文件结构

生成的Excel文件采用横向布局：

### 表头结构
| 日期 | 荔新大道DN1200流量计 | 新城大道医院DN800流量计 | 宁西总表DN1200 | ... |
|------|---------------------|------------------------|----------------|-----|
| 2025-08-08 | 135824.00 | 16501.00 | 113211.00 | ... |
| 2025-08-09 | 135596.00 | 15976.00 | 112823.00 | ... |
| 2025-08-10 | 139265.00 | 16952.00 | 116525.00 | ... |

### 布局特点
- **第一列**: 日期列（按时间顺序排列）
- **其他列**: 各个水表的名称作为列标题
- **数据单元格**: 对应日期和水表的用水量数值

## 📊 数据特点

- **水表总数**: 8个（系统配置的所有水表）
- **日期范围**: 通常为7-8天（昨天往前推7天）
- **数据格式**: 数值自动格式化，大数值高亮显示
- **缺失处理**: 空值显示为空白，不影响整体布局

## 🎨 样式特点

### 标题区域
- 系统标题：水务数据获取系统 - 水表用水量报表
- 生成时间：自动显示文件生成时间
- 蓝色主题色调

### 表头样式
- 深蓝色背景 (#4472C4)
- 白色字体
- 居中对齐
- 边框线条

### 数据区域
- 交替行色彩（可选）
- 大数值高亮显示
- 数值格式化（千位分隔符）
- 自动列宽调整

## 🔧 技术实现

### 依赖库
- `openpyxl`: Excel文件操作
- `pandas`: 数据处理
- `datetime`: 日期处理

### 核心功能
- `extract_horizontal_data()`: 提取横向格式数据
- `create_horizontal_excel()`: 创建横向布局Excel文件
- `export_to_excel()`: 主导出函数

## 📝 文件位置

- **导出目录**: `excel_exports/`
- **命名规则**: `水表数据_{开始日期}至{结束日期}_{时间戳}.xlsx`
- **文件大小**: 约5-6KB（8个水表，7-8天数据）

## ⚠️ 注意事项

1. **数据依赖**: 需要先获取水务数据才能导出
2. **文件权限**: 确保有excel_exports目录的写入权限
3. **Excel兼容性**: 生成的文件兼容Excel 2010及以上版本
4. **中文支持**: 使用UTF-8编码，支持中文文件名和内容

## 🐛 故障排除

### 常见问题

**问题1**: 导出时提示"没有可导出的数据"
- **解决**: 先运行数据获取功能，确保有可用数据

**问题2**: Excel文件无法打开
- **解决**: 检查openpyxl库是否正确安装

**问题3**: 文件名显示乱码
- **解决**: 确保系统支持UTF-8编码

### 测试命令
```bash
# 测试Excel导出模块
python excel_exporter.py

# 测试真实数据导出
python test_excel_with_real_data.py

# 检查生成的文件
dir excel_exports
```

## 📈 版本历史

- **v1.0** (2025-08-16): 基础Excel导出功能
  - 支持昨天数据提取
  - 基础样式和格式化
  - Web界面集成
  - 统计信息生成

## 🔮 未来计划

- [ ] 支持自定义日期范围导出
- [ ] 添加图表和可视化
- [ ] 支持多种导出格式（CSV、PDF）
- [ ] 数据对比和趋势分析
- [ ] 自动邮件发送功能

---

*© 2025 水务数据获取系统 - Excel导出功能*

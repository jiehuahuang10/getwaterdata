# 日期限制功能说明

## ✅ **已实现：每月25日才能添加新统计表**

---

## 📅 **规则说明**

### **更新时间限制**
- ✅ **允许添加**：每月**25日及以后**
- ❌ **禁止添加**：每月**1日-24日**

### **原因**
月度数据统计周期为：**上月25日 至 本月24日**

例如：
- 9月数据 = 8月25日 - 9月24日
- 10月数据 = 9月25日 - 10月24日

**必须等到本月24日数据完整后才能准确统计！**

---

## 🎯 **具体示例**

### **场景1：10月20日尝试添加10月统计表**

**系统响应**：
```
❌ 拒绝操作

[提示] 还没到更新日期！

当前日期：2025年10月20日
更新日期：每月25日

请在2025年10月25日后再添加新的月度统计表。

原因：月度数据统计周期为上月25日至本月24日，
需等本月24日数据完整后才能准确统计。
```

### **场景2：10月25日尝试添加10月统计表**

**系统响应**：
```
✅ 允许操作

正在提取10月数据（9月25日 - 10月24日）...
成功添加 2025年10月 统计表！
```

---

## 📊 **时间表**

| 日期 | 可以添加的月份 | 状态 |
|-----|-------------|------|
| 9月1日-24日 | - | ❌ 不能添加任何新月份 |
| 9月25日-30日 | 9月 | ✅ 可以添加9月统计表 |
| 10月1日-24日 | - | ❌ 不能添加10月统计表 |
| 10月25日-31日 | 10月 | ✅ 可以添加10月统计表 |
| 11月1日-24日 | - | ❌ 不能添加11月统计表 |
| 11月25日-30日 | 11月 | ✅ 可以添加11月统计表 |

---

## 💡 **最佳实践**

### **推荐操作时间**
**每月25日或26日**添加上个月的统计表

例如：
- 10月25日 → 添加10月统计表
- 11月25日 → 添加11月统计表

### **为什么不在1日添加？**
虽然习惯上我们会在"每月1日"做月度汇总，但由于：
1. 数据统计周期是25日-24日（不是1日-30/31日）
2. 1日时，上月24日的数据可能还没完全录入
3. 25日时，上月25日-本月24日的完整数据已经齐全

**所以25日是最合适的添加时间！**

---

## 🔧 **技术实现**

### **代码逻辑**
```python
from datetime import date

def add_monthly_summary_to_main(month_offset=1, use_real_data=False):
    # 获取当前日期
    today = date.today()
    
    # 检查是否到了25日
    if today.day < 25:
        return {
            "success": False,
            "message": "还没到更新日期！请在每月25日后添加..."
        }
    
    # 25日及以后，允许添加
    # ... 继续添加逻辑
```

### **检查点**
- ✅ Web界面会自动检查
- ✅ 后端API会验证日期
- ✅ Python脚本也会检查

---

## 🧪 **测试**

### **当前日期：2025年10月20日**

**测试结果**：
```bash
$ python test_date_check.py

[Current Date] 2025年10月20日 (Day: 20)
[Result] Success: False
[Expected Behavior] [OK]
  System correctly blocked the operation
  Required day: 25th or later
```

✅ **功能正常！**

---

## 🌐 **Web界面提示**

当您在10月1日-24日访问Web界面并点击"添加下一个月"时：

**弹窗显示**：
```
操作失败

[提示] 还没到更新日期！

当前日期：2025年10月20日
更新日期：每月25日

请在2025年10月25日后再添加新的月度统计表。

原因：月度数据统计周期为上月25日至本月24日，
需等本月24日数据完整后才能准确统计。
```

---

## ❓ **常见问题**

### Q1: 为什么不能提前添加？
**A**: 数据周期是25日-24日，如果在24日之前添加，数据不完整会导致统计不准确。

### Q2: 如果25日忘记添加了怎么办？
**A**: 没关系！只要在25日之后的任何时候添加都可以，数据源中的数据是持久保存的。

### Q3: 可以一次添加多个月吗？
**A**: 可以！只要是25日之后，可以点击"添加下一个月"多次，或使用"添加下两个月"。

### Q4: 如果实在需要在25日之前添加怎么办？
**A**: 如有特殊需求，可以：
1. 临时修改系统日期限制（不推荐）
2. 直接使用Python脚本绕过检查（开发者模式）
3. 联系管理员调整规则

---

## 📝 **修改历史**

- **2025-10-20**: 添加日期限制功能，要求每月25日后才能添加新统计表

---

**这个规则确保了数据的完整性和准确性！** ✅


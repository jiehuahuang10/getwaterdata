# 水务数据获取系统 - Web界面使用说明

## 🌐 Web界面简介

本系统提供了一个直观的Web界面，让您可以通过浏览器轻松获取和查看水务数据，无需使用命令行。

## 🚀 快速启动

### 方法一：使用启动脚本（推荐）
```bash
python start_web.py
```

### 方法二：直接启动
```bash
python web_app.py
```

启动后，系统会自动：
- 检查并安装必需的依赖
- 启动Web服务器
- 自动打开浏览器访问界面

## 📱 访问地址

- **本地访问**: http://localhost:5000
- **局域网访问**: http://你的IP地址:5000

## 🎯 主要功能

### 1. 主页面 (/)

#### 📊 系统信息显示
- **当前时间**: 显示系统当前时间
- **数据范围**: 自动计算的最近7天日期范围
- **水表数量**: 目标8个水表
- **预计用时**: 约30-60秒

#### 🚀 一键获取数据
- 点击 **"🚀 获取最近7天数据"** 按钮
- 系统自动执行以下步骤：
  1. 登录水务系统
  2. 访问报表页面
  3. 获取8个水表数据
  4. 解析并显示结果

#### 📈 实时进度显示
- **进度条**: 显示任务执行进度
- **状态信息**: 实时更新当前执行步骤
- **错误提示**: 如有问题会显示详细错误信息

#### 📊 数据展示
获取成功后，页面会显示：
- **水表卡片**: 每个水表的详细信息
- **统计数据**: 最大值、最小值、平均值、管径
- **最近数据**: 最近3天的具体数值
- **美观界面**: 响应式设计，支持手机和电脑

### 2. 历史数据页面 (/history)

#### 📋 数据文件列表
- **文件名**: 显示所有已获取的数据文件
- **获取时间**: 数据获取的具体时间
- **水表数量**: 每个文件包含的水表数量
- **数据范围**: 数据的日期范围
- **文件大小**: 文件大小信息

## 🏭 目标水表列表

系统获取以下8个水表的完整数据：

1. **荔新大道DN1200流量计** (1261181000263)
2. **新城大道医院DN800流量计** (1261181000300)
3. **宁西总表DN1200** (1262330402331)
4. **三江新总表DN800** (2190066)
5. **沙庄总表** (2190493)
6. **2501200108** (2501200108)
7. **如丰大道600监控表** (2520005)
8. **三棵树600监控表** (2520006)

## 📅 数据获取逻辑

- **动态日期计算**: 系统自动计算"昨天往前推7天"的日期范围
- **例如**: 如果今天是2025年8月16日，则获取2025年8月8日至2025年8月15日的数据
- **真实数据**: 从广州增城自来水公司ThinkWater系统获取真实数据

## 🔧 技术特点

### 后端技术
- **Flask**: Python Web框架
- **多线程**: 后台执行数据获取任务
- **实时状态**: 通过Ajax轮询获取任务进度
- **数据处理**: 自动解析和格式化水务数据

### 前端技术
- **响应式设计**: 支持PC和移动设备
- **现代UI**: 美观的渐变色彩和卡片式布局
- **实时更新**: JavaScript实时显示进度和结果
- **用户友好**: 直观的操作界面和状态提示

## 📊 数据输出

### JSON格式数据文件
每次获取的数据都会保存为JSON文件，包含：
- **元数据**: 获取时间、数据来源、成功状态
- **日期范围**: 具体的数据时间范围
- **水表信息**: 8个目标水表的ID和名称
- **详细数据**: 每个水表每天的具体数值
- **统计信息**: 最大值、最小值、平均值等

### 示例文件名
```
COMPLETE_8_METERS_data_20250816_113724.json
```

## 🛠️ 故障排除

### 常见问题

#### 1. 无法启动Web服务
**解决方案**:
```bash
# 检查Python版本
python --version

# 安装依赖
pip install flask==3.0.0

# 检查端口占用
netstat -ano | findstr :5000
```

#### 2. 数据获取失败
**可能原因**:
- 网络连接问题
- 水务系统维护
- 账号密码变更

**解决方案**:
- 检查网络连接
- 等待系统恢复
- 更新config.py中的账号信息

#### 3. 页面显示异常
**解决方案**:
- 刷新浏览器页面
- 清除浏览器缓存
- 尝试使用其他浏览器

### 日志查看
系统会在控制台输出详细的运行日志，包括：
- 启动信息
- 请求处理
- 错误信息
- 数据获取进度

## 🔒 安全说明

- **本地运行**: Web界面默认只在本地运行
- **无需外网**: 系统可在内网环境中使用
- **数据安全**: 所有数据保存在本地
- **访问控制**: 可通过防火墙控制访问权限

## 📈 性能优化

- **后台执行**: 数据获取在后台线程中执行
- **进度反馈**: 实时显示任务执行进度
- **缓存机制**: 自动显示最新获取的数据
- **响应式设计**: 优化移动设备访问体验

## 🎨 界面特色

- **现代设计**: 渐变色彩和圆角设计
- **卡片布局**: 清晰的信息分组显示
- **动画效果**: 流畅的交互动画
- **状态指示**: 清晰的成功/错误状态显示
- **数据可视化**: 直观的数据展示方式

## 📞 技术支持

如遇到问题，请：
1. 查看控制台输出的错误信息
2. 检查网络连接和系统状态
3. 参考故障排除章节
4. 查看生成的数据文件确认功能是否正常

---

*最后更新: 2025-08-16*  
*版本: Web界面 v1.0*  
*技术栈: Python + Flask + JavaScript + HTML5*

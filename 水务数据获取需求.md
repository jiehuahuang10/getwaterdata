# 水务数据获取需求文档

## 项目概述
从广州增城自来水公司ThinkWater智慧水网系统获取水表数据的Python HTTP请求脚本。
**本项目采用纯HTTP请求方式实现，不使用任何浏览器自动化工具。**

## 系统信息
- **系统名称**: 广州增城自来水公司-ThinkWater智慧水网 V1.0.7
- **登录地址**: http://axwater.dmas.cn/Login.aspx
- **账号**: 13509288500
- **密码**: 288500

## 功能需求

### 1. 登录功能
- 使用提供的账号密码自动登录系统
- 处理登录验证和跳转

### 2. 数据获取流程
1. **访问报表页面**
   - 通过HTTP请求直接访问报表页面URL: `/reports/FluxRpt.aspx`

2. **选择目标水表**
   - 需要选择以下6个水表（使用正确的ID格式）：
     - 2501200108
     - 1261181000263
     - 1262330402331  
     - 2520005
     - 2520006
     - 1261181000300

3. **设置报表参数**
   - 报表类型：选择"日报表" (参数值: type="dayRpt")
   - 计量类型：全部 (参数值: meterType="-1")
   - 统计类型：流量 (参数值: statisticsType="flux")
   - 时间范围：优先使用2024年历史数据（如2024-07-24到2024-07-31）

### 3. 数据提取要求
- **目标数据**：从返回的HTML表格中提取水表数据
- **数据内容**：包含以下字段
  - 抄表时间
  - 最小值
  - 最小值时间
  - 平均值  
  - 每日具体数值（根据指定日期范围）

- **输出格式**：在后台控制台输出获取的数据，并保存到HTML文件供检查

## 技术实现要点

### 使用的Python库（仅限HTTP请求方式）
- `requests` - 用于HTTP请求和会话管理
- `beautifulsoup4` - 用于HTML解析
- `time` - 用于添加请求间隔
- `json` - 用于处理JSON响应（如果有）

### 实现步骤（纯HTTP请求方式）
1. **环境准备**
   - 安装所需的Python库：requests, beautifulsoup4
   - **不使用任何浏览器自动化工具**

2. **登录模块**
   - 使用requests.Session()维护会话
   - GET请求获取登录页面，提取ASP.NET状态信息
   - POST请求提交登录表单数据
   - 验证登录成功状态

3. **报表页面访问**
   - 通过HTTP请求访问报表页面URL
   - 获取和维护必要的页面状态（ViewState, EventValidation等）

4. **数据获取模块**
   - 使用表单POST请求提交查询参数
   - 参数包括：水表ID、日期范围、报表类型等
   - 通过BeautifulSoup解析返回的HTML表格数据

5. **数据解析模块**
   - 解析HTML表格结构
   - 提取目标数据字段
   - 格式化输出到控制台

## 重要说明
**本项目严格要求只使用HTTP请求方式实现，不得使用任何浏览器自动化工具（如Selenium、Playwright等）**

## 已验证的技术实现方法
基于测试验证，以下方法已确认可行：

### API端点信息
- **登录验证**: 已成功通过HTTP请求实现登录
- **报表页面**: `http://axwater.dmas.cn/reports/FluxRpt.aspx`  
- **数据获取**: 通过表单POST请求获取数据

### 关键技术点
- 使用`requests.Session()`维护登录状态
- 正确处理ASP.NET的`__VIEWSTATE`和`__EVENTVALIDATION`参数
- nodeId参数格式：每个水表ID需要用单引号包围，如`'2501200108','1261181000263'`
- 表单提交方式已验证有效，API直接调用返回空响应

## 注意事项
- 需要正确处理ASP.NET的ViewState和EventValidation参数
- 维护会话状态，确保Cookie正确传递
- 考虑网络异常和HTTP请求失败的情况
- 注意系统可能的反爬虫机制和会话超时
- 确保数据提取的准确性和完整性
- 合理控制请求频率，避免过于频繁的请求

## 预期输出示例
```
水表数据获取结果：
抄表时间: 2025-07-26, 最小值: 134778.000, 最小值时间: 2025-07-28, 平均值: 137656.000
2025-07-24: 137101.000
2025-07-25: 139935.000
2025-07-26: 141386.000
...
```
# 测试指南 - 真实数据自动填充功能

## ✅ **服务器已启动**

Flask Web服务器正在运行：
- **端口**: 5001
- **状态**: ✅ RUNNING

---

## 🎯 **测试步骤**

### **步骤1：打开浏览器**

在浏览器中访问：
```
http://localhost:5001
```

或者：
```
http://127.0.0.1:5001
```

### **步骤2：查看当前状态**

页面会自动显示：
- 当前Excel文件路径
- 最后一个月份（例如：2025年9月）
- 可以添加的下一个月（例如：2025年10月）

### **步骤3：点击"添加下一个月"按钮**

当您点击按钮后，系统会：

1. **自动识别最后月份**
   ```
   检测到：2025年9月（第58行）
   ```

2. **计算目标月份**
   ```
   目标：2025年10月
   ```

3. **提取真实数据**（这是新功能！）
   ```
   从：石滩供水服务部每日总供水情况.xlsx
   时间范围：2025-09-25 至 2025-10-24
   提取31天的数据
   ```

4. **填充监控点数据**
   ```
   荔新大道:              提取的实际数值
   宁西2总表:             提取的实际数值
   如丰大道600监控表:     提取的实际数值
   新城大道医院NB:        提取的实际数值
   三棵树600监控表:       提取的实际数值
   ```

5. **生成公式**
   ```
   供水量 = B-C-D 或 D+E-F 或 F
   损耗水量 = 供水量 - 售水量
   水损耗率 = 损耗水量 / 供水量
   ```

6. **显示成功消息**
   ```
   ✓ 成功添加 2025年10月 统计表
   基于最后月份 2025年9月（第58行）
   添加位置：第XX行-第XX行
   ```

### **步骤4：打开Excel验证**

打开文件：
```
excel_exports/石滩区分区计量.xlsx
```

**查看新添加的统计表**：

1. **找到"2025年10月"标题**
2. **检查数据行**：
   - 第1行（总表）：
     - B列（荔新大道）= **真实数值**（不是随机数！）
     - C列（宁西总表）= **真实数值**
     - D列（如丰大道）= **真实数值**
     - G列（供水量）= **自动计算** (=B-C-D)
     - I列（损耗水量）= **自动计算** (=G-H)
     - J列（水损耗率）= **自动计算** (=I/G)

   - 第2行（总表）：
     - D列（如丰大道）= **真实数值**
     - E列（新城大道医院NB）= **真实数值**
     - F列（三棵竹）= **真实数值**
     - G列（供水量）= **自动计算** (=D+E-F)

   - 第3行（分表）：
     - F列（三棵竹）= **真实数值**
     - G列（供水量）= **自动计算** (=F)

3. **检查合计行**：
   - G列（供水量合计）= **SUM公式**
   - H列（售水量合计）= **SUM公式**
   - I列（损耗水量合计）= **公式**
   - J列（水损耗率合计）= **公式**

---

## 🔍 **验证要点**

### ✅ **数据真实性**
监控点的数值应该是**具体的数字**（例如：4,264,205），而不是接近的整数（例如：4,200,000）

### ✅ **公式正确性**
在Excel中双击任意计算列，应该看到公式（例如：`=G69-H69`）

### ✅ **格式一致性**
新表格的格式（字体、颜色、边框）应该与9月的表格一致

### ✅ **数据合理性**
- 供水量 > 0
- 售水量 > 0
- 水损耗率通常在 -10% 到 70% 之间

---

## 🧪 **测试场景**

### **场景1：添加10月数据**（如果10月数据存在）
```
预期结果：✅ 使用真实数据
```

### **场景2：添加未来月份**（如果数据不存在）
```
预期结果：⚠️ 自动降级到模拟数据
系统会显示警告信息
```

### **场景3：重复添加同一个月**
```
预期结果：❌ 系统拒绝，提示"已存在"
```

---

## 📊 **对比测试**

### **之前的模拟数据**
```
荔新大道: 4,234,567  (随机生成)
宁西总表: 3,456,789  (随机生成)
```

### **现在的真实数据**
```
荔新大道: 4,264,205  (从数据源提取)
宁西总表: 3,457,264  (从数据源提取)
```

**区别**：
- 真实数据更精确
- 数值不会是整数或接近整数
- 每次添加同一个月的数据都相同

---

## 🐛 **如果遇到问题**

### **问题1：数据是模拟的（随机数）**
**可能原因**：
- 数据源文件不存在
- 目标月份的数据还没有

**解决方法**：
- 检查`excel_exports/石滩供水服务部每日总供水情况.xlsx`是否存在
- 检查该文件是否包含目标月份的数据

### **问题2：服务器错误**
**可能原因**：
- import错误
- 文件路径问题

**解决方法**：
- 查看终端输出的错误信息
- 确保所有文件都在正确的位置

### **问题3：Web页面打不开**
**可能原因**：
- 服务器未启动
- 端口被占用

**解决方法**：
```bash
# 检查服务器状态
netstat -ano | findstr :5001

# 如果需要重启
python add_summary_web.py
```

---

## 🎯 **快速测试脚本**

如果您想直接用Python测试（不通过Web界面）：

```python
from add_summary_web import add_monthly_summary_to_main

# 测试：使用真实数据添加下一个月
result = add_monthly_summary_to_main(month_offset=1, use_real_data=True)
print(result)
```

---

## 📋 **测试检查清单**

完成以下检查：

- [ ] Web页面可以正常访问
- [ ] 点击"添加下一个月"按钮成功
- [ ] 看到成功消息
- [ ] Excel文件中新增了统计表
- [ ] 新统计表的月份正确
- [ ] 监控点数据是真实值（不是随机数）
- [ ] 所有公式都自动生成
- [ ] 合计行有SUM公式
- [ ] 格式与原有表格一致
- [ ] 刷新页面后看到新的"最后月份"

---

## 🚀 **下一步**

测试成功后，您可以：

1. **批量添加历史数据**（如果需要补充）
2. **设置自动化任务**（每月1日自动添加）
3. **优化售水量数据**（目前是模拟值）
4. **添加数据质量报告**

---

**准备好了吗？** 

现在就打开浏览器访问 **http://localhost:5001** 开始测试！ 🎉


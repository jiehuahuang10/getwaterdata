# 每月自动添加统计表功能说明（石滩区主表）

## 📋 功能概述

每月1号自动在 **"石滩区"主工作表** 底部添加新的月度统计表。

例如：
- 10月1日 → 在"石滩区"工作表底部添加"2025年11月"统计表
- 11月1日 → 在"石滩区"工作表底部添加"2025年12月"统计表

---

## ✅ 已完成功能

### 1. 自动添加完整统计表

添加的内容包括：

- **月份标题行**：2025年X月
- **表头行**：荔新大道、宁西总表（插入式）DN1200、如丰大道、新城大道医院NB、三樵仔、供水量、售水量、损耗水量、水损耗（百分比）
- **数据行**：1区、2区、3区（3行）
- **合计行**：合计:

### 2. 格式完全一致

- ✅ 字体样式（宋体、大小、粗体）
- ✅ 对齐方式（居中、左对齐）
- ✅ 边框样式
- ✅ 填充颜色
- ✅ 数字格式
- ✅ 与现有8月、9月统计表格式完全一致

### 3. 智能检测

- ✅ 自动识别下个月
- ✅ 检测是否已添加（避免重复）
- ✅ 仅在每月1号执行

---

## 🚀 使用方法

### 方法1: 手动执行（测试）

```bash
# 测试添加统计表（不管是否1号）
python auto_add_monthly_summary_main.py --force
```

### 方法2: 定时自动执行（推荐）

#### 使用GitHub Actions

已配置好的工作流：`.github/workflows/monthly-summary.yml`

- **执行时间**: 每月1号早上8点（北京时间）
- **自动提交**: 添加后自动提交到GitHub
- **手动触发**: 可以在GitHub Actions页面手动运行

#### 使用Windows计划任务

1. 打开"任务计划程序"
2. 创建基本任务
3. 触发器：每月1号
4. 操作：启动程序
   ```
   程序：python
   参数：D:\pj\getwaterdata\auto_add_monthly_summary_main.py
   起始于：D:\pj\getwaterdata
   ```

---

## 📊 效果演示

### 添加前（石滩区工作表）
```
...
第64行：合计行（9月数据）
第65-72行：其他内容
```

### 添加后（石滩区工作表）
```
...
第64行：合计行（9月数据）
第65-72行：其他内容
第73行：空行
第74行：2025年11月 ← 新添加
第75行：表头（荔新大道、宁西总表...）
第76行：1区 | 0 | 0 | 0 | 0 | 0 | 0 | 0 | 0 | 0
第77行：2区 | 0 | 0 | 0 | 0 | 0 | 0 | 0 | 0 | 0
第78行：3区 | 0 | 0 | 0 | 0 | 0 | 0 | 0 | 0 | 0
第79行：合计: | 0 | 0 | 0 | 0
```

---

## 🔧 文件说明

### 核心文件

1. **`auto_add_monthly_summary_main.py`** - 主程序
   - 在"石滩区"主表添加统计表
   - 自动识别月份
   - 检测重复

2. **`.github/workflows/monthly-summary.yml`** - GitHub Actions配置
   - 定时执行
   - 自动提交

3. **`add_summary_to_main_sheet.py`** - 测试脚本
   - 用于开发测试
   - 保存到新文件

---

## 📸 实际效果

### 测试文件已生成
```
excel_exports\石滩区分区计量_主表已添加.xlsx
```

打开此文件，查看 **"石滩区"** 工作表，滚动到底部（第74-79行），您会看到：

- ✅ 第74行：**2025年11月**（月份标题）
- ✅ 第75行：表头
- ✅ 第76-78行：1区、2区、3区数据
- ✅ 第79行：合计行

**格式与8月、9月的统计表完全一致！**

---

## ⚠️ 注意事项

### 1. 工作表位置

- ✅ 添加到：**"石滩区"主工作表**
- ❌ 不是添加到："石滩2025年9月"等月度工作表

### 2. 文件占用问题

**问题**: 如果Excel文件正在被打开，程序无法保存。

**解决**:
- 关闭Excel文件后再运行
- 或使用GitHub Actions（服务器上没有文件占用）

### 3. 重复添加检测

程序会检查最后10行是否已存在相同月份的统计表，避免重复添加。

如果检测到重复，会输出：
```
[WARN] 检测到已存在 2025年11月 的统计表（第X行）
[WARN] 跳过添加，避免重复
```

### 4. 数据初始值

新添加的统计表所有数据初始化为 `0`，需要后续手动或自动填充。

---

## 💬 使用示例

### 示例1: 测试添加

```bash
# 1. 测试添加（保存到新文件）
python add_summary_to_main_sheet.py

# 2. 打开新文件查看效果
# excel_exports/石滩区分区计量_主表已添加.xlsx

# 3. 确认无误后，正式添加
python auto_add_monthly_summary_main.py --force
```

### 示例2: 配置GitHub Actions

```bash
# 1. 提交代码到GitHub
git add .
git commit -m "添加每月自动统计表功能（石滩区主表）"
git push

# 2. 在GitHub网站上：
#    - 进入仓库
#    - 点击 "Actions"
#    - 找到 "每月添加统计表"
#    - 点击 "Run workflow" 测试

# 3. 查看执行结果
#    - 查看日志
#    - 检查是否有新的commit
#    - 下载更新后的Excel文件
```

---

## 🎯 总结

### 当前状态
✅ **功能已完全实现！**

- 可以在每月1号自动在"石滩区"主表添加统计表
- 格式和样式与现有8月、9月统计表完全一致
- 支持手动和自动执行
- 已配置GitHub Actions

### 添加位置
- ✅ **工作表**："石滩区"（主汇总表）
- ✅ **位置**：当前表格最底部
- ✅ **格式**：与8月、9月统计表一致

### 下一步
等待您的需求，实现数据自动填充功能！

---

**如有任何问题或需要调整，请随时告诉我！** 🚀

